<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Todo App with Dark Mode & Persistence</title>
<style>
  :root {
    --bg-color: #fff;
    --text-color: #000;
    --task-bg: #f0f0f0;
    --button-bg: #007bff;
    --button-color: #fff;
    --border-color: #ccc;
    --fade-duration: 0.5s;
  }

  body.dark-mode {
    --bg-color: #222;
    --text-color: #eee;
    --task-bg: #444;
    --button-bg: #0069d9;
    --button-color: #fff;
    --border-color: #555;
  }

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    position: relative;
    border-bottom: 1px solid var(--border-color);
  }

  h1 {
    margin: 0;
    font-size: 1.5rem;
  }

  .top-buttons {
    display: flex;
    gap: 0.5rem;
  }

  button {
    padding: 0.5rem 1rem;
    border: none;
    background-color: var(--button-bg);
    color: var(--button-color);
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.3s;
  }

  button:hover {
    background-color: darken(var(--button-bg), 10%);
  }

  .dark-toggle {
    position: absolute;
    top: 1rem;
    right: 1rem;
  }

  main {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
  }

  form {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  input[type="text"] {
    flex: 1;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1rem;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    background-color: var(--task-bg);
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    opacity: 0;
    transform: translateY(-10px);
    animation: fadeIn 0.5s forwards;
  }

  li.done {
    text-decoration: line-through;
    opacity: 0.6;
  }

  .task-text {
    flex: 1;
  }

  .task-buttons {
    display: flex;
    gap: 0.5rem;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
</head>
<body>
<header>
  <h1>Todo List</h1>
  <div class="top-buttons">
    <button id="clearAllBtn">Clear All</button>
  </div>
  <button class="dark-toggle" id="darkModeBtn">Dark Mode</button>
</header>
<main>
  <form id="todoForm">
    <input type="text" id="taskInput" placeholder="Add a new task" required />
    <button type="submit">Add</button>
  </form>
  <ul id="taskList"></ul>
</main>
<script>
  const taskInput = document.getElementById('taskInput');
  const taskList = document.getElementById('taskList');
  const todoForm = document.getElementById('todoForm');
  const clearAllBtn = document.getElementById('clearAllBtn');
  const darkModeBtn = document.getElementById('darkModeBtn');
  const body = document.body;

  // Load tasks from localStorage
  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];

  // Function to save tasks to localStorage
  function saveTasks() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  // Function to create task element
  function createTask(task) {
    const li = document.createElement('li');
    li.innerHTML = `
      <span class="task-text">${task.text}</span>
      <div class="task-buttons">
        <button class="doneBtn">${task.done ? 'Undo' : 'Done'}</button>
        <button class="deleteBtn">Delete</button>
      </div>
    `;
    if (task.done) {
      li.classList.add('done');
      li.querySelector('.doneBtn').textContent = 'Undo';
    }

    // Event listener for Done/Undo button
    li.querySelector('.doneBtn').addEventListener('click', () => {
      task.done = !task.done;
      saveTasks();
      updateTaskList();
    });

    // Event listener for Delete button
    li.querySelector('.deleteBtn').addEventListener('click', () => {
      tasks = tasks.filter(t => t.id !== task.id);
      saveTasks();
      updateTaskList();
    });

    return li;
  }

  // Function to update task list UI
  function updateTaskList() {
    taskList.innerHTML = '';
    tasks.forEach(task => {
      const taskEl = createTask(task);
      if (task.done) {
        taskEl.classList.add('done');
        taskEl.querySelector('.doneBtn').textContent = 'Undo';
      }
      taskList.appendChild(taskEl);
    });
  }

  // Load existing tasks on page load
  window.addEventListener('load', () => {
    updateTaskList();
    // Check for dark mode preference
    if (localStorage.getItem('darkMode') === 'enabled') {
      body.classList.add('dark-mode');
      darkModeBtn.textContent = 'Light Mode';
    }
  });

  // Handle form submission to add new task
  todoForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const text = taskInput.value.trim();
    if (text) {
      const newTask = {
        id: Date.now(),
        text,
        done: false
      };
      tasks.push(newTask);
      saveTasks();
      const taskEl = createTask(newTask);
      // Add fade-in animation
      taskEl.style.opacity = '0';
      taskEl.style.transform = 'translateY(-10px)';
      taskList.appendChild(taskEl);
      requestAnimationFrame(() => {
        taskEl.style.transition = `opacity ${getComputedStyle(document.documentElement).getPropertyValue('--fade-duration')}, transform ${getComputedStyle(document.documentElement).getPropertyValue('--fade-duration')}`;
        taskEl.style.opacity = '1';
        taskEl.style.transform = 'translateY(0)';
      });
      taskInput.value = '';
    }
  });

  // Handle Clear All button
  document.getElementById('clearAllBtn').addEventListener('click', () => {
    tasks = [];
    saveTasks();
    updateTaskList();
  });

  // Handle Dark Mode toggle
  darkModeBtn.addEventListener('click', () => {
    if (body.classList.contains('dark-mode')) {
      body.classList.remove('dark-mode');
      darkModeBtn.textContent = 'Dark Mode';
      localStorage.setItem('darkMode', 'disabled');
    } else {
      body.classList.add('dark-mode');
      darkModeBtn.textContent = 'Light Mode';
      localStorage.setItem('darkMode', 'enabled');
    }
  });
</script>
</body>
</html>